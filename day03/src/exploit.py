import os
import webbrowser

from bs4 import BeautifulSoup

with open("../materials/evilcorp.html") as file:
    html_content = file.read()
soup = BeautifulSoup(html_content, "html.parser")

new_title = soup.new_tag("title")
new_title.string = "Evil Corp - Stealing your money every day"
soup.find("title").replace_with(new_title)

name = soup.find('span', class_='name').get_text()
new_h1_tag = soup.new_tag("h1")
new_h1_tag.string = name + ", you are hacked"
soup.body.insert(0, new_h1_tag)

new_content = """
 <script>
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );
</script>
"""
new_soup = BeautifulSoup(new_content, "html.parser")
body_tag = soup.body
body_tag.append(new_soup)

link_tag = soup.find('a')
link_tag['href'] = 'https://mrrobot.fandom.com/wiki/Fsociety'
link_tag.string = 'Fsociety'

with open("../materials/evilcorp_hacked.html", "w") as file:
    file.write(str(soup))

webbrowser.open("file://" + (os.path.join(os.getcwd(), "../materials/evilcorp_hacked.html")))
